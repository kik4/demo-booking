# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€demo-bookingã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã«å‘ã‘ãŸå®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ“Š ç¾åœ¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³

### âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆå¼·å›ºãªåŸºç›¤ï¼‰

| é …ç›® | èª¬æ˜ | å®Ÿè£…æ—¥ |
|------|------|--------|
| **CSRFåŸºæœ¬ä¿è­·** | Next.js 15 Server Actionsè‡ªå‹•ä¿è­· | åŸºç›¤ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿è­·** | Supabase RLSï¼ˆè¡Œãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰ | åŸºç›¤ |
| **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚·ã‚¹ãƒ†ãƒ ** | IPãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥åˆ¶é™ã€ãƒ†ã‚¹ãƒˆå®Œå‚™ | 2025-07-26 |
| **èªè¨¼ãƒ»èªå¯** | Supabase Auth + ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ | åŸºç›¤ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼** | åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š | 2025-07-26 |
| **JWT ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†** | 15åˆ†æœ‰åŠ¹æœŸé™ã€ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–° | 2025-07-26 |
| **åŸºæœ¬CSPä¿è­·** | Content Security Policyå®Ÿè£… | 2025-07-26 |

### âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆè¿½åŠ å®Ÿè£…ï¼‰

| é …ç›® | èª¬æ˜ | å®Ÿè£…æ—¥ |
|------|------|--------|
| **HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ & ãƒ­ã‚°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–** | Valibotãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ + safeLogãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ | 2025-07-26 |
| **XSSå…¥åŠ›æ¤œè¨¼** | HTMLã‚¿ã‚°ãƒ»å±é™ºæ–‡å­—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡ºã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | 2025-07-26 |
| **çµ±ä¸€ãƒ­ã‚°ç®¡ç†** | 44ç®‡æ‰€ã®consoleä½¿ç”¨ã‚’safeLogã§çµ±ä¸€ã€æ”¹è¡Œãƒ»åˆ¶å¾¡æ–‡å­—é™¤å» | 2025-07-26 |
| **åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ** | 19ä»¶ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ | 2025-07-26 |
| **HTTPSå¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ** | ç’°å¢ƒå¯¾å¿œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒã®ã¿ï¼‰ | 2025-07-26 |

### âš ï¸ æ”¹å–„å¯¾è±¡é …ç›®

| é …ç›® | ç¾åœ¨ã®çŠ¶æ…‹ | ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ« |
|------|------------|--------------|
| å®Œå…¨CSPï¼ˆNonceï¼‰ | åŸºæœ¬CSPè¨­å®šæ¸ˆã¿ | ä½ |
| WAFçµ±åˆ | æœªå®Ÿè£… | ä¸­ |
| å¤–éƒ¨ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ | æœªå®Ÿè£… | ä¸­ |

## ğŸ›£ï¸ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

## ãƒ•ã‚§ãƒ¼ã‚º1: å³åº§å®Ÿè£…ï¼ˆ1-2æ—¥ï¼‰âš¡ âœ… **å®Œäº†: 2025-07-26**

### å„ªå…ˆåº¦: ğŸ”´ æœ€é«˜ - **å®Ÿè£…å®Œäº†**

#### 1.1 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ 

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `next.config.ts`

```typescript
const nextConfig: NextConfig = {
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'Referrer-Policy',
            value: 'strict-origin-when-cross-origin',
          },
          {
            key: 'X-XSS-Protection',
            value: '1; mode=block',
          },
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=31536000; includeSubDomains',
          },
        ],
      },
    ];
  },
};
```

**åŠ¹æœ**:
- ã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚­ãƒ³ã‚°æ”»æ’ƒé˜²æ­¢
- MIME sniffingæ”»æ’ƒé˜²æ­¢  
- XSSæ”»æ’ƒè»½æ¸›
- HTTPSå¼·åˆ¶

**æ¤œè¨¼æ–¹æ³•**:
```bash
curl -I https://yourdomain.com | grep -E "(X-Frame|X-Content|Referrer)"
```

#### 1.2 JWTæœ‰åŠ¹æœŸé™çŸ­ç¸®

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/config.toml`

```toml
[auth]
jwt_expiry = 900  # 15åˆ†ï¼ˆç¾åœ¨: 3600ç§’ï¼‰
enable_refresh_token_rotation = true
refresh_token_reuse_interval = 5  # 5ç§’ï¼ˆç¾åœ¨: 10ç§’ï¼‰
```

**åŠ¹æœ**:
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºå®šæ”»æ’ƒãƒªã‚¹ã‚¯è»½æ¸›
- ãƒˆãƒ¼ã‚¯ãƒ³ç›—ç”¨æ™‚ã®å½±éŸ¿æœ€å°åŒ–

**æ¤œè¨¼æ–¹æ³•**:
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèª
supabase status
# ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ç¢ºèª
```

#### 1.3 åŸºæœ¬CSPè¨­å®š

**å®Ÿè£…**: next.config.tsã«è¿½åŠ 

```typescript
{
  key: 'Content-Security-Policy',
  value: [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline'", // æ®µéšçš„ã«'unsafe-inline'å‰Šé™¤äºˆå®š
    "style-src 'self' 'unsafe-inline'",
    "img-src 'self' data: https:",
    "font-src 'self' data:",
    "connect-src 'self' https://api.supabase.co",
  ].join('; '),
},
```

**æ¤œè¨¼æ–¹æ³•**:
- ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºãƒ„ãƒ¼ãƒ«ã§CSPã‚¨ãƒ©ãƒ¼ç¢ºèª
- å…¨ãƒšãƒ¼ã‚¸ã®æ­£å¸¸å‹•ä½œç¢ºèª

---

## ãƒ•ã‚§ãƒ¼ã‚º2: çŸ­æœŸå®Ÿè£…ï¼ˆ1é€±é–“ï¼‰ğŸŸ¡ âœ… **ãƒ•ã‚§ãƒ¼ã‚º2.1å®Œäº†: 2025-07-26**

### å„ªå…ˆåº¦: ğŸŸ¡ é«˜

#### 2.1 HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ & ãƒ­ã‚°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­– âœ… **å®Œäº†: 2025-07-26**

**å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: DOMPurifyã«ã‚ˆã‚‹è‡ªå‹•ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªãã€Valibotãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹å…¥åŠ›æ¤œè¨¼ã‚’æ¡ç”¨

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/sanitize.ts`

```typescript
/**
 * ãƒ­ã‚°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
 * æ”¹è¡Œæ–‡å­—ã€åˆ¶å¾¡æ–‡å­—ã‚’å‰Šé™¤ã—ã¦ãƒ­ã‚°ã®æ•´åˆæ€§ã‚’ä¿ã¤
 */
export function sanitizeForLog(input: string): string {
  return input
    .replace(/[\r\n\t]/g, " ") // æ”¹è¡Œãƒ»ã‚¿ãƒ–ã‚’ç©ºç™½ã«å¤‰æ›
    .replace(/[\u0000-\u001f]/g, "") // åˆ¶å¾¡æ–‡å­—é™¤å»
    .replace(/[\u007f-\u009f]/g, "") // æ‹¡å¼µåˆ¶å¾¡æ–‡å­—é™¤å»
    .substring(0, 200) // é•·ã•åˆ¶é™ï¼ˆãƒ­ã‚°ã®è‚¥å¤§åŒ–é˜²æ­¢ï¼‰
    .trim();
}

/**
 * å®‰å…¨ãªãƒ­ã‚°å‡ºåŠ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 * 44ç®‡æ‰€ã®consoleä½¿ç”¨ã‚’çµ±ä¸€
 */
export const safeLog = {
  error: (message: string, data?: unknown) => {
    const safeData = sanitizeLogData(data);
    console.error(message, safeData);
  },
  warn: (message: string, data?: unknown) => {
    const safeData = sanitizeLogData(data);
    console.warn(message, safeData);
  },
  info: (message: string, data?: unknown) => {
    console.info(message, data);
  },
} as const;
```

**é©ç”¨ç®‡æ‰€**:
- **å…¥åŠ›æ¤œè¨¼**: `bookingFormSchema.ts`, `profileSchema.ts`ã«HTMLã‚¿ã‚°æ¤œè¨¼è¿½åŠ 
- **ãƒ­ã‚°çµ±ä¸€**: å…¨Server Actionsï¼ˆ44ç®‡æ‰€ï¼‰ã§safeLogä½¿ç”¨
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 19ä»¶ã®åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆè¿½åŠ 

**UXé‡è¦–è¨­è¨ˆ**: 
- ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã§å‹æ‰‹ã«æ–‡å­—ãŒæ¶ˆãˆã‚‹ã“ã¨ã‚’é˜²æ­¢
- HTMLã‚¿ã‚°å…¥åŠ›æ™‚ã¯æ˜ç¢ºãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

#### 2.2 ç›£æŸ»ãƒ­ã‚°æ©Ÿèƒ½

**å®Ÿè£…**: `lib/auditLog.ts`

```typescript
interface SecurityEvent {
  event: string;
  userId?: string;
  ip: string;
  userAgent?: string;
  timestamp: Date;
  metadata?: Record<string, any>;
}

export function logSecurityEvent(eventData: Omit<SecurityEvent, 'timestamp'>) {
  const event: SecurityEvent = {
    ...eventData,
    timestamp: new Date(),
  };

  // é–‹ç™ºç’°å¢ƒ
  console.log('[SECURITY]', JSON.stringify(event, null, 2));
  
  // æœ¬ç•ªç’°å¢ƒã§ã¯å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSentryç­‰ï¼‰ã«é€ä¿¡
  if (process.env.NODE_ENV === 'production') {
    // TODO: å¤–éƒ¨ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹é€£æº
  }
}

// ä½¿ç”¨ä¾‹
export const SecurityEvents = {
  RATE_LIMIT_EXCEEDED: 'RATE_LIMIT_EXCEEDED',
  INVALID_LOGIN_ATTEMPT: 'INVALID_LOGIN_ATTEMPT',
  SUSPICIOUS_ACTIVITY: 'SUSPICIOUS_ACTIVITY',
} as const;
```

#### 2.3 HTTPSå¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ âœ… **å®Œäº†: 2025-07-26**

**å®Ÿè£…å®Œäº†**: next.config.tsã«ç’°å¢ƒå¯¾å¿œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè¨­å®šè¿½åŠ 

```typescript
async redirects() {
  // HTTPSå¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆæœ¬ç•ªç’°å¢ƒã®ã¿ï¼‰
  if (process.env.NODE_ENV === "production") {
    const domain = process.env.VERCEL_URL 
      ? `https://${process.env.VERCEL_URL}`
      : process.env.NEXT_PUBLIC_SITE_URL || "https://yourdomain.com";
    
    return [
      {
        source: "/(.*)",
        has: [
          {
            type: "header",
            key: "x-forwarded-proto",
            value: "http",
          },
        ],
        destination: `${domain}/$1`,
        permanent: true,
      },
    ];
  }
  
  // é–‹ç™ºç’°å¢ƒã§ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãªã—
  return [];
},
```

**æ©Ÿèƒ½**:
- æœ¬ç•ªç’°å¢ƒã§ã®ã¿HTTPSå¼·åˆ¶ï¼ˆé–‹ç™ºç’°å¢ƒã¯é™¤å¤–ï¼‰
- ç’°å¢ƒå¤‰æ•°å¯¾å¿œï¼ˆVercelã€ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
- 301æ°¸ç¶šãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

---

## ãƒ•ã‚§ãƒ¼ã‚º3: ä¸­æœŸå®Ÿè£…ï¼ˆ1-2é€±é–“ï¼‰ğŸŸ 

### å„ªå…ˆåº¦: ğŸŸ  ä¸­

#### 3.1 å®Œå…¨CSPå®Ÿè£…

**æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:

1. **Nonceç”Ÿæˆæ©Ÿèƒ½**

```typescript
// lib/csp.ts
import { randomBytes } from 'crypto';

export function generateNonce(): string {
  return randomBytes(16).toString('base64');
}

// middleware.tsã§Nonceè¨­å®š
export function middleware(request: NextRequest) {
  const nonce = generateNonce();
  const response = NextResponse.next();
  
  response.headers.set('x-nonce', nonce);
  return response;
}
```

2. **å³æ ¼CSPè¨­å®š**

```typescript
{
  key: 'Content-Security-Policy',
  value: [
    "default-src 'none'",
    "script-src 'self' 'nonce-{NONCE}'",
    "style-src 'self' 'nonce-{NONCE}'",
    "img-src 'self' data:",
    "font-src 'self'",
    "connect-src 'self' https://api.supabase.co",
    "form-action 'self'",
  ].join('; '),
},
```

#### 3.2 Redisç§»è¡Œï¼ˆUpstashï¼‰

**è¨­å®šæ‰‹é †**:

1. **Upstashã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**
2. **ç’°å¢ƒå¤‰æ•°è¿½åŠ **

```bash
# .env.local
UPSTASH_REDIS_REST_URL=https://your-redis-url
UPSTASH_REDIS_REST_TOKEN=your-token
```

3. **å®Ÿè£…**: `lib/rateLimit.ts`æ›´æ–°

```typescript
import { Redis } from '@upstash/redis';

const redis = Redis.fromEnv();

export async function withRateLimitRedis<T>(
  config: RateLimitConfig,
  action: () => Promise<T>,
): Promise<T | { error: string; rateLimited: true }> {
  const key = `rate_limit:${ip}`;
  const count = await redis.incr(key);
  
  if (count === 1) {
    await redis.expire(key, Math.ceil(config.windowMs / 1000));
  }
  
  if (count > config.maxRequests) {
    const ttl = await redis.ttl(key);
    return {
      error: `ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚${ttl}ç§’å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚`,
      rateLimited: true,
    };
  }
  
  return action();
}
```

#### 3.3 å¤–éƒ¨ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ

**Sentryçµ±åˆä¾‹**:

```bash
pnpm add @sentry/nextjs
```

```typescript
// sentry.client.config.ts
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 1.0,
});

// lib/auditLog.tsæ›´æ–°
export function logSecurityEvent(eventData: SecurityEvent) {
  if (process.env.NODE_ENV === 'production') {
    Sentry.addBreadcrumb({
      message: eventData.event,
      level: 'warning',
      data: eventData.metadata,
    });
  }
}
```

---

## ãƒ•ã‚§ãƒ¼ã‚º4: é•·æœŸå®Ÿè£…ï¼ˆ1ãƒ¶æœˆï¼‰ğŸŸ¢

### å„ªå…ˆåº¦: ğŸŸ¢ ä½

#### 4.1 WAFï¼ˆWeb Application Firewallï¼‰å°å…¥

**Cloudflareè¨­å®š**:
- Bot Fight Modeæœ‰åŠ¹åŒ–
- Rate Limiting Rulesè¨­å®š
- Custom Rules for APIä¿è­·

**AWS WAFè¨­å®šä¾‹**:
```json
{
  "Rules": [
    {
      "Name": "SQLInjectionRule",
      "Priority": 1,
      "Statement": {
        "SqliMatchStatement": {
          "FieldToMatch": {
            "Body": {}
          }
        }
      },
      "Action": {
        "Block": {}
      }
    }
  ]
}
```

#### 4.2 ä¾µå…¥æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

**å®Ÿè£…**: `lib/intrusion-detection.ts`

```typescript
interface SuspiciousActivity {
  userId?: string;
  ip: string;
  pattern: string;
  severity: 'low' | 'medium' | 'high';
  count: number;
}

export class IntrusionDetector {
  private suspiciousActivities = new Map<string, SuspiciousActivity>();
  
  async detectSuspiciousActivity(
    ip: string,
    pattern: string,
    userId?: string
  ): Promise<void> {
    const key = `${ip}:${pattern}`;
    const activity = this.suspiciousActivities.get(key);
    
    if (activity) {
      activity.count++;
      if (activity.count > 10) {
        await this.triggerAlert(activity);
      }
    } else {
      this.suspiciousActivities.set(key, {
        userId,
        ip,
        pattern,
        severity: 'low',
        count: 1,
      });
    }
  }
  
  private async triggerAlert(activity: SuspiciousActivity): Promise<void> {
    // Slack/Discord/Emailé€šçŸ¥
    console.log('ğŸš¨ SECURITY ALERT:', activity);
  }
}
```

#### 4.3 å®šæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»

**è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/security-audit.ts`

```typescript
import { exec } from 'child_process';
import { promisify } from 'util';

const execPromise = promisify(exec);

export async function runSecurityAudit(): Promise<void> {
  console.log('ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»é–‹å§‹...');
  
  try {
    // ä¾å­˜é–¢ä¿‚è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
    await execPromise('pnpm audit');
    
    // TypeScriptå‹ãƒã‚§ãƒƒã‚¯
    await execPromise('pnpm type:check');
    
    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    await execPromise('pnpm test:run');
    
    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãƒã‚§ãƒƒã‚¯
    const { stdout } = await execPromise('curl -I https://localhost:3000');
    console.log('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼:', stdout);
    
    console.log('âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»å®Œäº†');
  } catch (error) {
    console.error('âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»å¤±æ•—:', error);
    process.exit(1);
  }
}
```

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º1 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ âœ… **å®Œäº†**
- [x] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®šå®Œäº†
- [x] JWTæœ‰åŠ¹æœŸé™çŸ­ç¸®è¨­å®š
- [x] åŸºæœ¬CSPè¨­å®š
- [x] æœ¬ç•ªç’°å¢ƒã§ã®ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
- [x] å…¨ãƒšãƒ¼ã‚¸ã®å‹•ä½œç¢ºèª

### ãƒ•ã‚§ãƒ¼ã‚º2 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ âœ… **ãƒ•ã‚§ãƒ¼ã‚º2.1-2.3å®Œäº†**
- [x] HTMLã‚¿ã‚°æ¤œè¨¼æ©Ÿèƒ½å®Ÿè£…ï¼ˆValibotã‚¹ã‚­ãƒ¼ãƒï¼‰
- [x] ãƒ­ã‚°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–å®Ÿè£…ï¼ˆsafeLogãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰
- [x] çµ±ä¸€ãƒ­ã‚°ç®¡ç†ï¼ˆ44ç®‡æ‰€ã®consoleä½¿ç”¨çµ±ä¸€ï¼‰
- [x] åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆï¼ˆ19ä»¶ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
- [x] XSSæ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºæ©Ÿèƒ½
- [x] HTTPSå¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè¨­å®šï¼ˆç’°å¢ƒå¯¾å¿œï¼‰
- [ ] å¤–éƒ¨ç›£æŸ»ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆï¼ˆãƒ•ã‚§ãƒ¼ã‚º2.2ã¨ã—ã¦ç¶™ç¶šï¼‰
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½

### ãƒ•ã‚§ãƒ¼ã‚º3 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] Nonceç”Ÿæˆæ©Ÿèƒ½å®Ÿè£…
- [ ] å³æ ¼CSPè¨­å®š
- [ ] UpstashRedisè¨­å®š
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™Redisç§»è¡Œ
- [ ] Sentryé€£æºè¨­å®š

### ãƒ•ã‚§ãƒ¼ã‚º4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] WAFè¨­å®š
- [ ] ä¾µå…¥æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…
- [ ] è‡ªå‹•ç›£æŸ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
- [ ] ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥è¨­å®š
- [ ] å®šæœŸå®Ÿè¡Œè¨­å®šï¼ˆCI/CDï¼‰

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

| ãƒ•ã‚§ãƒ¼ã‚º | æŒ‡æ¨™ | ç›®æ¨™å€¤ | å®Ÿè£…çŠ¶æ³ |
|----------|------|--------|----------|
| 1 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®šç‡ | 100% | âœ… **é”æˆ** |
| 1 | ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“çŸ­ç¸® | 15åˆ†ä»¥ä¸‹ | âœ… **é”æˆ** (15åˆ†) |
| 2.1 | XSSå…¥åŠ›æ¤œè¨¼ | 100% | âœ… **é”æˆ** (HTMLã‚¿ã‚°ãƒ»å±é™ºæ–‡å­—æ¤œè¨¼) |
| 2.1 | ãƒ­ã‚°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­– | 100% | âœ… **é”æˆ** (44ç®‡æ‰€çµ±ä¸€) |
| 2.1 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ | >90% | âœ… **é”æˆ** (19ä»¶ãƒ†ã‚¹ãƒˆ) |
| 2.3 | HTTPSå¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ | 100% | âœ… **é”æˆ** (ç’°å¢ƒå¯¾å¿œ) |
| 2.2 | å¤–éƒ¨ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²ç‡ | 100% | â³ **æœªå®Ÿè£…** |
| 3 | CSPé•å | 0ä»¶ | âœ… **é”æˆ** |
| 3 | Rediså¿œç­”æ™‚é–“ | <100ms | â³ **æœªå®Ÿè£…** |
| 4 | è‡ªå‹•æ¤œçŸ¥ç‡ | >95% | â³ **æœªå®Ÿè£…** |
| 4 | ç›£æŸ»å®Ÿè¡Œé »åº¦ | é€±1å› | â³ **æœªå®Ÿè£…** |

## ğŸ“ ã‚µãƒãƒ¼ãƒˆãƒ»è³ªå•

å®Ÿè£…ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:

1. **æŠ€è¡“çš„è³ªå•**: é–‹ç™ºãƒãƒ¼ãƒ Slack #security-channel
2. **ç·Šæ€¥äº‹æ…‹**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †ã«å¾“ã†
3. **å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼**: æœˆæ¬¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šè­°ã§é€²æ—ç¢ºèª

---

---

## ğŸ“ˆ å®Ÿè£…é€²æ—

### å®Œäº†ãƒ•ã‚§ãƒ¼ã‚º
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆå³åº§å®Ÿè£…ï¼‰**: 2025-07-26å®Œäº†
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã€JWTæœ‰åŠ¹æœŸé™çŸ­ç¸®ã€åŸºæœ¬CSPè¨­å®š
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º2.1ï¼ˆHTMLã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ & ãƒ­ã‚°ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼‰**: 2025-07-26å®Œäº†
  - Valibotãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€safeLogãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã€åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º2.3ï¼ˆHTTPSå¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰**: 2025-07-26å®Œäº†
  - ç’°å¢ƒå¯¾å¿œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè¨­å®šã€æœ¬ç•ªç’°å¢ƒã§ã®HTTPSå¼·åˆ¶

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
- ğŸ”„ **ãƒ•ã‚§ãƒ¼ã‚º2.2ï¼ˆç›£æŸ»ãƒ­ã‚°å¼·åŒ–ï¼‰**: å¤–éƒ¨ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆã€ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½
- â³ **ãƒ•ã‚§ãƒ¼ã‚º3ï¼ˆä¸­æœŸå®Ÿè£…ï¼‰**: å®Œå…¨CSPï¼ˆNonceï¼‰ã€Redisç§»è¡Œ
- â³ **ãƒ•ã‚§ãƒ¼ã‚º4ï¼ˆé•·æœŸå®Ÿè£…ï¼‰**: WAFå°å…¥ã€ä¾µå…¥æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

---

**æœ€çµ‚æ›´æ–°**: 2025-07-26  
**ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†**: 2025-07-26  
**ãƒ•ã‚§ãƒ¼ã‚º2.1å®Œäº†**: 2025-07-26  
**ãƒ•ã‚§ãƒ¼ã‚º2.3å®Œäº†**: 2025-07-26
